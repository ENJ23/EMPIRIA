<div class="event-detail-container" *ngIf="event$ | async as event; else loading">
    <div class="hero-banner" [style.backgroundImage]="'url(' + event.imageUrl + ')'">
        <div class="overlay"></div>
        <div class="container hero-content">
            <span class="category-badge">{{ event.categories[0] }}</span>
            <h1 class="event-title">{{ event.title }}</h1>
            <div class="event-meta">
                <span class="meta-item">
                    <span class="material-icons">calendar_today</span>
                    {{ event.date | date:'fullDate' }}
                </span>
                <span class="meta-item">
                    <span class="material-icons">location_on</span>
                    {{ event.location }}
                </span>
            </div>
        </div>
    </div>

    <div class="container content-grid">
        <div class="main-content">
            <section class="section">
                <h2 class="section-heading">Sobre el Evento</h2>
                <p class="description">{{ event.description }}</p>
            </section>

            <section class="section">
                <h2 class="section-heading">Organizador</h2>
                <div class="organizer-card">
                    <div class="organizer-avatar">E</div>
                    <div>
                        <h4>Empiria Jujuy</h4>
                        <p>Organizadora Oficial</p>
                    </div>
                </div>
            </section>
        </div>

        <aside class="sidebar">
            <div class="ticket-card">
                <h3>Adquirir Entradas</h3>

                <div class="ticket-type" [class.selected]="selectedTicket === 'general'"
                    (click)="selectTicket('general', event.priceRange.min)">
                    <div class="ticket-info">
                        <span class="ticket-name">General</span>
                        <span class="ticket-stock">Disponibles</span>
                    </div>
                    <span class="ticket-price">${{ event.priceRange.min }}</span>
                </div>

                <div class="ticket-type" [class.selected]="selectedTicket === 'vip'"
                    (click)="selectTicket('vip', event.priceRange.max)">
                    <div class="ticket-info">
                        <span class="ticket-name">VIP Experience</span>
                        <span class="ticket-stock">Últimos lugares</span>
                    </div>
                    <span class="ticket-price">${{ event.priceRange.max }}</span>
                </div>

                <div class="summary" *ngIf="selectedTicket">
                    <div class="summary-row">
                        <span>Entrada {{ selectedTicket | titlecase }}</span>
                        <span>${{ currentPrice }}</span>
                    </div>
                    <div class="summary-row total">
                        <span>Total</span>
                        <span>${{ currentPrice }}</span>
                    </div>
                </div>

                <button class="btn btn-block" [disabled]="!selectedTicket || isProcessing" (click)="purchase()">
                    {{ isProcessing ? 'Procesando...' : 'Confirmar Compra' }}
                </button>
                <p class="secure-note">
                    <span class="material-icons">lock</span> Pago 100% Seguro
                </p>
            </div>
        </aside>
    </div>
</div>

<ng-template #loading>
    <div class="container section text-center">
        <p>Cargando evento...</p>
    </div>
</ng-template>

<!-- Payment Modal -->
<div class="modal-overlay" *ngIf="showPaymentModal" (click)="closeModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
        <h3>Finalizar Compra</h3>
        <p>Escanea el código QR con tu celular o haz clic en el botón para pagar.</p>

        <div class="qr-container" *ngIf="qrCodeUrl">
            <img [src]="qrCodeUrl" alt="QR de Pago">
        </div>

        <div class="modal-actions">
            <a [href]="paymentUrl" class="btn" target="_blank">
                Pagar con Mercado Pago
            </a>
            <button class="btn-secondary" (click)="closeModal()">
                Cancelar
            </button>
        </div>
    </div>
</div>