<div class="my-payments-container">
    <h2>Mis Pagos</h2>

    <!-- Loading State -->
    <div *ngIf="loading" class="loading">
        <p>Cargando tus pagos...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="error && !loading" class="error-message">
        <p>{{ error }}</p>
        <button (click)="loadMyPayments()" class="btn-retry">Reintentar</button>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && !error && payments.length === 0" class="empty-state">
        <p>No tienes pagos aún</p>
        <p class="subtitle">Los pagos que realices aparecerán aquí</p>
    </div>

    <!-- Payments List -->
    <div *ngIf="!loading && payments.length > 0" class="payments-grid">
        <div *ngFor="let payment of payments" class="payment-card">
            <!-- Header with Event Title -->
            <div class="payment-header">
                <h3>{{ payment.event?.title }}</h3>
                <span [ngClass]="getStatusClass(payment.status)" class="payment-status">
                    {{ getStatusLabel(payment.status) }}
                </span>
            </div>

            <!-- Payment Details -->
            <div class="payment-details">
                <div class="detail-row">
                    <strong>Fecha de evento:</strong>
                    <span>{{ formatDate(payment.event?.date) }}</span>
                </div>
                <div class="detail-row">
                    <strong>Ubicación:</strong>
                    <span>{{ payment.event?.location }}</span>
                </div>
                <div class="detail-row">
                    <strong>Cantidad:</strong>
                    <span>{{ payment.quantity }} entrada(s)</span>
                </div>
                <div class="detail-row">
                    <strong>Monto:</strong>
                    <span>${{ payment.quantity > 0 ? (payment.mp_payment_id ? '...' : 'Pendiente') : 'N/A' }}</span>
                </div>
                <div class="detail-row">
                    <strong>Pagado:</strong>
                    <span>{{ formatDate(payment.createdAt) }}</span>
                </div>
            </div>

            <!-- Reservation Status Section -->
            <div *ngIf="payment.isReserved" class="reservation-section">
                <div [ngClass]="payment.isReservationActive ? 'reservation-active' : 'reservation-expired'">
                    <div class="reservation-header">
                        <strong>Estado de Reserva:</strong>
                        <span class="reservation-time">
                            {{ getTimeRemainingLabel(payment) }}
                        </span>
                    </div>
                    <p class="reservation-note">
                        <em>Accede a tu código QR antes de que expire la reserva</em>
                    </p>
                </div>
            </div>

            <!-- Actions Section -->
            <div class="payment-actions">
                <!-- Pay Now Button (if still pending/active) -->
                <button 
                    *ngIf="payment.status === 'pending' && payment.canAccessQR && payment.mp_init_point"
                    (click)="goToPayment(payment)" 
                    class="btn-pay-now">
                    Ir a Pagar
                </button>

                <!-- Approved Message -->
                <div *ngIf="payment.status === 'approved'" class="approved-message">
                    ✓ Pago completado correctamente
                </div>

                <!-- Rejected/Cancelled Message -->
                <div *ngIf="payment.status === 'rejected' || payment.status === 'cancelled'" class="rejected-message">
                    ✗ Este pago no pudo procesarse
                </div>
            </div>
        </div>
    </div>
</div>
